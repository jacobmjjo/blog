---
title: "AWS 503문제"
date: 2021-06-06T10:07:53+09:00
slug: ""
description: ""
keywords: []
draft: true
tags: []
math: false
toc: false
---


https://josephmjjo.github.io/blog/aws_504_error/

동일 로드밸런스에서 이번에는 503문제가 발생하였습니다.  
503문제가 뭔지 우선 알아야 하는데 503이란 쉽게 이해하자면 서버가 정상이 아닐때 발생하는 에러입니다.  
504와의 차이점은 504는 응답서버가 응답을 못할 뿐이지 살아있다는것은 확인한 상태 입니다. 하지만 503은 응답서버 자체를 확인을 못하는 상태입니다.  
아래 웹사이트에서도 비슷하게 설명합니다.  
[웹페이지 503 에러](https://jamesdreaming.tistory.com/34)

웹페이지 503 에러는 "503 Service Unavailable"을 의미 합니다.  
이는 서버쪽 문제로 인하여 서비스가 현재 불가능한 상태를 의미 합니다.

- 서버 접속자가 많아 서버 접속 불가
- 접속은 하였으나 서버 응답을 받지 못하여 타임아웃 발생
- 서버내 애플리케이션의 문제로 웹상에서 요청한 서비스가 정상 처리되지 못한 경우

일반적으로 503 에러는 첫번째 이유로 많이 발생합니다.  
서버 과부하 또는 서버 폭주라고도 하는 이유로 발생 하는 겁니다.  
web 서버의 아파치 로그를 뒤져보니 connect가 안된다는 로그를 확인할 수 있었습니다. 

![스크린샷 2021-11-18 오전 11.27.37.png](/img/aws_504_error/error_log.png)

해당 로그는 에러로그에 있습니다.  
동일한 시간대의 vpc flow로그를 살펴보니 was lb 주소가 다른 것을 확인 할 수 있었습니다.  
즉 원래 있어야할 WAS의 LB의 ip주소가 아닌 엉뚱한 ip로 보내고 있는 것이다.  
근데 아키텍처는 그대로이다. 여기서부터 미궁으로 빠졌다. 나는 왜 LB는 잘 설계했는데 정작 아파치는 엉뚱한 ip로 보내고 있을까??  
이 문제는 결국 아파치 문제 였던걸로 파악했다.

자세한건 아래의 링크에서 이어가겠다.  
[아파치 DNS 관리 기능으로 인한 로드밸런스 문제](https://josephmjjo.github.io/blog/apache_dns_error/)